(function(t){function e(e){for(var s,o,r=e[0],h=e[1],l=e[2],g=0,d=[];g<r.length;g++)o=r[g],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&d.push(a[o][0]),a[o]=0;for(s in h)Object.prototype.hasOwnProperty.call(h,s)&&(t[s]=h[s]);c&&c(e);while(d.length)d.shift()();return n.push.apply(n,l||[]),i()}function i(){for(var t,e=0;e<n.length;e++){for(var i=n[e],s=!0,r=1;r<i.length;r++){var h=i[r];0!==a[h]&&(s=!1)}s&&(n.splice(e--,1),t=o(o.s=i[0]))}return t}var s={},a={app:0},n=[];function o(e){if(s[e])return s[e].exports;var i=s[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=t,o.c=s,o.d=function(t,e,i){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)o.d(i,s,function(e){return t[e]}.bind(null,s));return i},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/simply-chess/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],h=r.push.bind(r);r.push=e,r=r.slice();for(var l=0;l<r.length;l++)e(r[l]);var c=h;n.push([0,"chunk-vendors"]),i()})({0:function(t,e,i){t.exports=i("cd49")},"00f2":function(t,e,i){"use strict";i("2c17")},"2a19":function(t,e,i){t.exports=i.p+"img/81.518cd5f8.svg"},"2c17":function(t,e,i){},"2c77":function(t,e,i){t.exports=i.p+"img/98.702c526d.svg"},"2ce2":function(t,e,i){t.exports=i.p+"img/75.5aad6e48.svg"},3036:function(t,e,i){t.exports=i.p+"img/112.876f1ece.svg"},"30a4":function(t,e,i){t.exports=i.p+"img/78.e6294efe.svg"},"3aae":function(t,e,i){t.exports=i.p+"img/107.8805b9ad.svg"},"49be":function(t,e,i){t.exports=i.p+"img/82.095b1a06.svg"},"667a":function(t,e,i){t.exports=i.p+"img/66.54dd3ab6.svg"},"9c4e":function(t,e,i){"use strict";i("c27c")},"9d0e":function(t,e,i){},a9ed:function(t,e,i){t.exports=i.p+"img/114.174de4ee.svg"},b10d:function(t,e,i){t.exports=i.p+"img/80.e38a4f66.svg"},b7d6:function(t,e,i){"use strict";i("9d0e")},c27c:function(t,e,i){},cd49:function(t,e,i){"use strict";i.r(e);var s=i("7a23");const a={class:"app"};function n(t,e,i,n,o,r){const h=Object(s["z"])("router-view");return Object(s["s"])(),Object(s["f"])("div",a,[Object(s["i"])(h)])}var o=Object(s["j"])({name:"App"}),r=(i("b7d6"),i("6b0d")),h=i.n(r);const l=h()(o,[["render",n]]);var c=l,g=i("6c02");const d=t=>(Object(s["v"])("data-v-205d7497"),t=t(),Object(s["t"])(),t),f={class:"fullscreen"},p={class:"container position-absolute top-50 start-50 translate-middle"},u=d(()=>Object(s["g"])("h1",{class:"pb-3 pt-3 text-large"},"Simply Chess",-1)),b={class:"row"},v={class:"col border border-light rounded-1 ms-3 me-3"},k=d(()=>Object(s["g"])("h3",{class:"pt-3"},"Start a New Game",-1)),M=d(()=>Object(s["g"])("p",{class:"pt-3"},"Start a new game in default starting position.",-1)),$={class:"col border border-light rounded-1 ms-3 me-3"},m=d(()=>Object(s["g"])("h3",{class:"pt-3"},"Load a Game",-1)),C=d(()=>Object(s["g"])("p",{class:"pt-3"},"Load an existing game using a FEN string.",-1)),y={class:"input-group mb-3"},O={class:"row"},j={class:"col border border-light rounded-1 ms-3 me-3 mt-3"},P=d(()=>Object(s["g"])("h3",null,"Additional Settings",-1)),w=Object(s["h"])("Play as: "),S=d(()=>Object(s["g"])("option",null,"light",-1)),A=d(()=>Object(s["g"])("option",null,"dark",-1)),L=[S,A],x={style:{"margin-bottom":".1em"}},q=Object(s["h"])(" Use AI?");function B(t,e,i,a,n,o){return Object(s["s"])(),Object(s["f"])("div",f,[Object(s["g"])("div",p,[u,Object(s["g"])("div",b,[Object(s["g"])("div",v,[k,M,Object(s["g"])("button",{class:"btn btn-success mb-3",onClick:e[0]||(e[0]=(...e)=>t.startGame&&t.startGame(...e))},"New Game")]),Object(s["g"])("div",$,[m,C,Object(s["g"])("div",y,[Object(s["H"])(Object(s["g"])("input",{class:"form-control",type:"text","onUpdate:modelValue":e[1]||(e[1]=e=>t.load=e),placeholder:"Input FEN string here."},null,512),[[s["F"],t.load]]),Object(s["g"])("button",{class:"btn btn-success",onClick:e[2]||(e[2]=(...e)=>t.startGame&&t.startGame(...e))},"Load Game")])])]),Object(s["g"])("div",O,[Object(s["g"])("div",j,[P,Object(s["g"])("div",null,[w,Object(s["H"])(Object(s["g"])("select",{"onUpdate:modelValue":e[3]||(e[3]=e=>t.playAs=e)},L,512),[[s["E"],t.playAs]])]),Object(s["g"])("div",x,[Object(s["H"])(Object(s["g"])("input",{type:"checkbox","onUpdate:modelValue":e[4]||(e[4]=e=>t.useAi=e)},null,512),[[s["D"],t.useAi]]),q]),t.useAi?Object(s["H"])((Object(s["s"])(),Object(s["f"])("select",{key:0,style:{"margin-bottom":".2em"},"onUpdate:modelValue":e[5]||(e[5]=e=>t.selectedAi=e)},[(Object(s["s"])(!0),Object(s["f"])(s["a"],null,Object(s["y"])(t.aiList,t=>(Object(s["s"])(),Object(s["f"])("option",{key:t},Object(s["B"])(t),1))),128))],512)),[[s["E"],t.selectedAi]]):Object(s["e"])("",!0)])])])])}var N=Object(s["j"])({name:"MainMenu",data(){return{load:null,useAi:!1,aiList:["RandomMover","MatrixEvaluator"],selectedAi:"RandomMover",playAs:"light"}},methods:{validateFen(){return this.load,!0},startGame(){if(this.validateFen()){const t=this.load?this.load:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 0";this.$router.push(`/play?fen=${t}&playAs=${this.playAs}&ai=${this.useAi}&aiType=${this.selectedAi}`)}}}});i("9c4e");const T=h()(N,[["render",B],["__scopeId","data-v-205d7497"]]);var F=T;const K={id:"app",class:"d-flex flex-row"},R={class:"side-menu mt-1 align-self-center"},D={class:"w-100"},H=Object(s["g"])("h1",null,"Simply Chess",-1),E={key:0,class:"w-100"},Q={key:1,class:"w-100"},I=Object(s["g"])("h2",null,"Tie game!",-1);function V(t,e,i,a,n,o){const r=Object(s["z"])("canvas-board");return Object(s["s"])(),Object(s["f"])("div",K,[Object(s["g"])("div",R,[Object(s["g"])("div",D,[H,Object(s["g"])("p",null,"Piece Placement: "+Object(s["B"])(t.engine.fen.piecePlacement),1),Object(s["g"])("p",null,"Active Color: "+Object(s["B"])(t.engine.fen.activeColor),1),Object(s["g"])("p",null,"Castling Availability: "+Object(s["B"])(t.engine.fen.castlingAvailability),1),Object(s["g"])("p",null,"En Passant Target Square: "+Object(s["B"])(t.engine.fen.enPassantTargetSquare),1),Object(s["g"])("p",null,"Half Move Clock: "+Object(s["B"])(t.engine.fen.halfMoveClock),1),Object(s["g"])("p",null,"Full Move Number: "+Object(s["B"])(t.engine.fen.fullMoveNumber),1),Object(s["g"])("p",null,"Check Status: "+Object(s["B"])(t.engine.checkStatus),1),Object(s["g"])("p",null,"Check Mate Status: "+Object(s["B"])(t.engine.checkMateStatus),1),Object(s["g"])("p",null,"Tie Status: "+Object(s["B"])(t.engine.tie),1),Object(s["g"])("p",null,"Selected Piece: "+Object(s["B"])(t.selectedPiece),1),Object(s["g"])("p",null,"Legal Moves: "+Object(s["B"])(t.legalMoves),1)]),t.engine.checkMateStatus?(Object(s["s"])(),Object(s["f"])("div",E,[Object(s["g"])("h2",null,"Winner: "+Object(s["B"])("light"===t.engine.checkStatus?"dark":"light"),1),Object(s["g"])("button",{onClick:e[0]||(e[0]=(...e)=>t.restart&&t.restart(...e))},"Restart?")])):Object(s["e"])("",!0),t.engine.tie?(Object(s["s"])(),Object(s["f"])("div",Q,[I,Object(s["g"])("button",{onClick:e[1]||(e[1]=(...e)=>t.restart&&t.restart(...e))},"Restart?")])):Object(s["e"])("",!0)]),Object(s["g"])("div",{class:"float-end",style:Object(s["o"])(`width: ${t.containerWidth}px; height: ${t.containerHeight}px`)},[t.isMounted?(Object(s["s"])(),Object(s["d"])(r,{key:0,"container-height":t.containerHeight,"container-width":t.containerWidth,"current-board-representation":t.fenString,"legal-moves-for-selection":t.legalMoves,onSelected:t.calculateLegalMoves,onDeselected:t.clearLegalMoves,onMove:t.makeMove},null,8,["container-height","container-width","current-board-representation","legal-moves-for-selection","onSelected","onDeselected","onMove"])):Object(s["e"])("",!0)],4)])}const W={id:"board",ref:"board"};function G(t,e,i,a,n,o){return Object(s["s"])(),Object(s["f"])("div",W,null,512)}var U=i("7aaa");function _(t){const[e,i,s,a,n,o]=t.split(" ");return{piecePlacement:e,activeColor:i,castlingAvailability:s,enPassantTargetSquare:a,halfMoveClock:Number(n),fullMoveNumber:Number(o)}}function z(t){return`${t.piecePlacement} ${t.activeColor} ${t.castlingAvailability} ${t.enPassantTargetSquare} ${t.halfMoveClock} ${t.fullMoveNumber}`}function J(t){const e=t.split("");for(let i=0;i<e.length;i++){const t=e[i].charCodeAt(0);if(t>48&&t<58){const s=t-48,a=Array(s).fill("x");e.splice(i,1,...a)}}return e}function X(t){const e={},i=t.split("/");let s=8;for(const a of i){const t=J(a);for(let i=0;i<t.length;i++){const a=st[i];e[`${a}-${s}`]=t[i]}s-=1}return e}function Y(t,e){return t.filter(t=>t.includes(e)).sort((t,e)=>t[0].charCodeAt(0)-e[0].charCodeAt(0))}function Z(t){const e=Object.keys(t);return[Y(e,"8"),Y(e,"7"),Y(e,"6"),Y(e,"5"),Y(e,"4"),Y(e,"3"),Y(e,"2"),Y(e,"1")]}function tt(t){let e="";const i=Z(t);for(let s=0;s<i.length;s++){const a=i[s];let n=0;for(let i=0;i<a.length;i++){const s=t[a[i]];"x"===s?n+=1:n>0?(e=`${e}${n}${s}`,n=0):e=`${e}${s}`}n>0&&(e=`${e}${n}`),s<i.length-1&&(e+="/")}return e}function et(t,e){return String.fromCharCode(t.charCodeAt(0)+e)}const it=[8,7,6,5,4,3,2,1],st=["a","b","c","d","e","f","g","h"],at=["a-1","a-2","a-3","a-4","a-5","a-6","a-7","a-8","b-1","b-2","b-3","b-4","b-5","b-6","b-7","b-8","c-1","c-2","c-3","c-4","c-5","c-6","c-7","c-8","d-1","d-2","d-3","d-4","d-5","d-6","d-7","d-8","e-1","e-2","e-3","e-4","e-5","e-6","e-7","e-8","f-1","f-2","f-3","f-4","f-5","f-6","f-7","f-8","g-1","g-2","g-3","g-4","g-5","g-6","g-7","g-8","h-1","h-2","h-3","h-4","h-5","h-6","h-7","h-8"];function nt(t,e,i,s){const a=i.x+s.x,n=i.y+s.y,o=a+i.width,r=n+i.height;return t<o&&t>a&&e<r&&e>n}function ot(t,e,i,s,a=null){if(a&&nt(t,e,a.parent,s))return a;const n=i.filter(e=>Math.abs(e.parent.x+s.x-t)<e.parent.width);for(const o of n)if(nt(t,e,o.parent,s))return o;return null}var rt=Object(s["j"])({name:"CanvasBoard",emits:["selected","deselected","move"],props:{currentBoardRepresentation:{type:String,default:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1"},containerHeight:{type:Number,default:100},containerWidth:{type:Number,default:100},boardConfig:{type:Object},legalMovesForSelection:{type:Array,default:()=>[]}},data(){return{app:new U["a"],containerLength:0,squareLength:0,boardContainer:new U["b"],pieces:{},textures:{},svgs:{},squareMap:{},boardMap:{},fen:{piecePlacement:"",activeColor:"",castlingAvailability:"",enPassantTargetSquare:"",halfMoveClock:0,fullMoveNumber:0},dark:11896931,light:15784373,drag:{dragData:null,dragNode:null,tempContainer:new U["b"],originalParent:null},highlight:{originalPlace:null,closestTarget:null,legalTargets:[]},placedPieces:[],freeSpaces:[],globalOffset:{x:0,y:0},cachedCollision:null}},watch:{currentBoardRepresentation(){this.updateFEN(this.currentBoardRepresentation)},legalMovesForSelection:{deep:!0,handler(){this.highlightLegalMoves()}}},mounted(){this.applyConfig();const t=this.$refs.board;t.style.width=this.containerWidth+"px",t.style.height=this.containerHeight+"px",this.app=new U["a"]({antialias:!0,resolution:window.devicePixelRatio,backgroundAlpha:0,resizeTo:t}),this.calculateContainerLength(),this.calculateSquareLength(),this.loadSVGs(),this.loadTextures();const e=new U["b"];e.interactive=!0,e.on("pointermove",this.onDragMove),this.app.stage.addChild(e),this.boardContainer=e,t.appendChild(this.app.view),this.drawBoard(),this.updateFEN(this.currentBoardRepresentation),this.app.stage.addChild(this.drag.tempContainer),e.x=this.app.screen.width/2,e.y=this.app.screen.height/2,e.pivot.x=e.width/2.28,e.pivot.y=e.height/2.28,this.calculateGlobalOffset()},beforeUnmount(){this.app.destroy()},methods:{calculateGlobalOffset(){this.globalOffset.x=this.boardContainer.x-this.boardContainer.width/2,this.globalOffset.y=this.boardContainer.y-this.boardContainer.height/2},applyConfig(){this.boardConfig&&(this.boardConfig.light&&(this.light=this.boardConfig.light),this.boardConfig.dark&&(this.dark=this.boardConfig.dark))},drawBoard(){for(let t=0;t<it.length;t++)for(let e=0;e<st.length;e++){const i=`${st[e]}-${it[t]}`,s=e*this.squareLength,a=t*this.squareLength,n=this.getColorForSquare(st[e],it[t]);this.squareMap[i]=this.drawSquare(s,a,n),this.squareMap[i].name=i}},getColorForSquare(t,e){const i=t.charCodeAt(0);return i%2!==0?e%2===0?this.light:this.dark:e%2===0?this.dark:this.light},loadSVGs(){this.svgs.B=new U["d"](i("667a"),{width:this.squareLength,height:this.squareLength}),this.svgs.K=new U["d"](i("2ce2"),{width:this.squareLength,height:this.squareLength}),this.svgs.N=new U["d"](i("30a4"),{width:this.squareLength,height:this.squareLength}),this.svgs.P=new U["d"](i("b10d"),{width:this.squareLength,height:this.squareLength}),this.svgs.Q=new U["d"](i("2a19"),{width:this.squareLength,height:this.squareLength}),this.svgs.R=new U["d"](i("49be"),{width:this.squareLength,height:this.squareLength}),this.svgs.b=new U["d"](i("2c77"),{width:this.squareLength,height:this.squareLength}),this.svgs.k=new U["d"](i("3aae"),{width:this.squareLength,height:this.squareLength}),this.svgs.n=new U["d"](i("eb21"),{width:this.squareLength,height:this.squareLength}),this.svgs.p=new U["d"](i("3036"),{width:this.squareLength,height:this.squareLength}),this.svgs.q=new U["d"](i("e229"),{width:this.squareLength,height:this.squareLength}),this.svgs.r=new U["d"](i("a9ed"),{width:this.squareLength,height:this.squareLength})},loadTextures(){this.textures.B=U["f"].from(this.svgs.B),this.textures.K=U["f"].from(this.svgs.K),this.textures.N=U["f"].from(this.svgs.N),this.textures.P=U["f"].from(this.svgs.P),this.textures.Q=U["f"].from(this.svgs.Q),this.textures.R=U["f"].from(this.svgs.R),this.textures.b=U["f"].from(this.svgs.b),this.textures.k=U["f"].from(this.svgs.k),this.textures.n=U["f"].from(this.svgs.n),this.textures.p=U["f"].from(this.svgs.p),this.textures.q=U["f"].from(this.svgs.q),this.textures.r=U["f"].from(this.svgs.r)},updateFEN(t){this.fen=_(t),this.boardMap=X(this.fen.piecePlacement),this.clearPieces(),this.placePieces()},findFreeSpaces(){const t=Object.keys(this.boardMap),e=[];for(const i of t)"x"===this.boardMap[i]&&e.push(this.squareMap[i]);this.freeSpaces=e},isPieceInteractive(t){return"w"===this.fen.activeColor&&t.charCodeAt(0)<97||"b"===this.fen.activeColor&&t.charCodeAt(0)>97},clearPieces(){for(let t=this.placedPieces.length-1;t>=0;t--){const t=this.placedPieces.pop();t&&t.destroy()}},placePieces(){for(const t of Object.keys(this.boardMap)){const e=this.boardMap[t];if("x"!==e){const i=this.textures[e],s=new U["e"](i);this.isPieceInteractive(e)&&(s.interactive=!0,s.buttonMode=!0,s.on("pointerdown",this.onDragStart).on("pointerup",this.onDragEnd).on("pointerupoutside",this.onDragEnd)),s.anchor.set(.5),s.name=e;const a=this.squareMap[t];a.addChild(s),this.placedPieces.push(s)}else{const e=new U["e"];e.interactive=!0,e.anchor.set(.5),e.width=this.squareLength,e.height=this.squareLength,e.alpha=0;const i=this.squareMap[t];i.addChild(e),this.placedPieces.push(e)}}},drawSquare(t,e,i){const s=new U["b"];if(s.position.set(t,e),this.app){const t=new U["c"];t.beginFill(i),t.drawRect(0,0,this.squareLength,this.squareLength),t.endFill(),t.pivot.x=t.width/2,t.pivot.y=t.height/2,s.addChild(t),this.boardContainer.addChild(s)}return s},onDragStart(t){var e;this.drag.dragData=t.data,this.drag.dragNode=t.currentTarget,this.drag.originalParent=null===(e=this.drag.dragNode)||void 0===e?void 0:e.parent,this.highlight.originalPlace=this.createHighlight(16777215),this.drag.originalParent.addChild(this.highlight.originalPlace);const i=t.currentTarget,s=i.name,a=i.parent.name;this.$emit("selected",{piece:s,place:a}),this.drag.dragNode.alpha=.5,this.drag.dragNode.setParent(this.drag.tempContainer),this.onDragMove()},createHighlight(t){const e=new U["c"];return e.beginFill(t),e.drawRect(0,0,this.squareLength,this.squareLength),e.endFill(),e.pivot.x=e.width/2,e.pivot.y=e.height/2,e.beginHole(),e.drawRect(this.squareLength/20,this.squareLength/20,this.squareLength-this.squareLength/10,this.squareLength-this.squareLength/10),e.endHole(),e},onDragEnd(){if(this.drag.dragNode){if(this.drag.dragNode.alpha=1,this.highlight.closestTarget){var t;const e={to:this.highlight.closestTarget.parent.name,from:null===(t=this.highlight.originalPlace)||void 0===t?void 0:t.parent.name,piece:this.drag.dragNode.name};this.$emit("move",e),console.log(e)}this.drag.dragNode.setParent(this.drag.originalParent),this.drag.dragNode.x=0,this.drag.dragNode.y=0}this.highlight.originalPlace&&this.highlight.originalPlace.destroy(),this.highlight.closestTarget&&this.highlight.closestTarget.destroy(),this.clearDrag(),this.clearHighlight(),this.$emit("deselected",!0)},onDragMove(){if(this.drag.dragNode){const t=this.drag.dragData.getLocalPosition(this.drag.dragNode.parent);t.x>this.containerWidth?this.drag.dragNode.x=this.containerWidth:t.x<0?this.drag.dragNode.x=0:this.drag.dragNode.x=t.x,t.y>this.containerHeight?this.drag.dragNode.y=this.containerHeight:t.y<0?this.drag.dragNode.y=0:this.drag.dragNode.y=t.y,this.clearCollision();const e=ot(t.x,t.y,this.highlight.legalTargets,this.globalOffset);if(this.cachedCollision=e,e){const t=this.createHighlight(255);e.parent.addChild(t),this.highlight.closestTarget=t}}},clearDrag(){this.drag.dragNode=null,this.drag.dragData=null,this.drag.originalParent=null},clearHighlight(){this.highlight.originalPlace=null,this.highlight.closestTarget=null,this.clearLegalMoves(),this.clearCollision()},highlightLegalMoves(){for(const t of this.legalMovesForSelection){const e=this.squareMap[t],i=this.createHighlight(65280);e.addChild(i),this.highlight.legalTargets.push(i)}},clearLegalMoves(){for(let t=this.highlight.legalTargets.length-1;t>=0;t--){const e=this.highlight.legalTargets[t];e.destroy(),this.highlight.legalTargets.pop()}},clearCollision(){this.highlight.closestTarget&&(this.highlight.closestTarget.destroy(),this.highlight.closestTarget=null)},calculateContainerLength(){this.containerLength=this.parentWidth()>this.parentHeight()?this.parentHeight():this.parentWidth()},parentWidth(){return this.app?this.app.view.width:0},parentHeight(){return this.app?this.app.view.height:0},calculateSquareLength(){this.squareLength=this.containerLength/it.length}}});const ht=h()(rt,[["render",G]]);var lt=ht,ct=i("ade3");class gt{constructor(t,e,i,s){Object(ct["a"])(this,"name",void 0),Object(ct["a"])(this,"code",void 0),Object(ct["a"])(this,"color",void 0),Object(ct["a"])(this,"position",void 0),Object(ct["a"])(this,"lastPosition",void 0),Object(ct["a"])(this,"rank",void 0),Object(ct["a"])(this,"file",void 0),Object(ct["a"])(this,"legalMoves",null),Object(ct["a"])(this,"moveType",void 0),Object(ct["a"])(this,"defending",[]),this.color=t,this.position=e,this.lastPosition=null,this.name=i,this.code=this.parseCode();const[a,n]=e.split("-");this.rank=Number(n),this.file=a,this.moveType=s}move(t){this.lastPosition=this.position,this.position=t;const[e,i]=t.split("-");this.rank=Number(i),this.file=e}getLegalMoves(t,e){return[]}filterValidMoves(t,e){return t.filter(t=>this.isValidMovePosition(t,e))}isValidMovePosition(t,e){const i="dark"===this.color?65:97,s="dark"===this.color?90:122,a="dark"===this.color?97:65,n="dark"===this.color?122:90;if(e[t]){const o=e[t].charCodeAt(0);return"x"===e[t]||(o>=a&&o<=n&&this.defending.push({code:e[t],position:t}),!!e[t]&&e[t].charCodeAt(0)>=i&&e[t].charCodeAt(0)<=s)}return!1}isMoveCapture(t,e){const i="dark"===this.color?65:97,s="dark"===this.color?90:122;return"x"!==e[t]&&(!!e[t]&&e[t].charCodeAt(0)>=i&&e[t].charCodeAt(0)<=s)}isOppositeColor(t){const e=t.charCodeAt(0);return"dark"===this.color?e<=90:e>=97}consecutiveMoveSearch(t,e,i){const s=[];let a=!1,n=!1,o=!1,r=!1,h=!1,l=!1,c=!1,g=!1;e&&(n=!0,h=!0,c=!0,g=!0),i&&(a=!0,o=!0,r=!0,l=!0);for(let u=this.rank+1;u<=8;u++){if(!a&&!o&&!n)break;if(n){const e=`${this.file}-${u}`;this.isValidMovePosition(e,t)?(s.push(e),this.isMoveCapture(e,t)&&(n=!1)):n=!1}if(o){const e=`${et(this.file,u-this.rank)}-${u}`;this.isValidMovePosition(e,t)?(s.push(e),this.isMoveCapture(e,t)&&(o=!1)):o=!1}if(a){const e=`${et(this.file,-1*(u-this.rank))}-${u}`;this.isValidMovePosition(e,t)?(s.push(e),this.isMoveCapture(e,t)&&(a=!1)):a=!1}}for(let u=this.rank-1;u>=1;u--){if(!l&&!r&&!h)break;if(h){const e=`${this.file}-${u}`;this.isValidMovePosition(e,t)?(s.push(e),this.isMoveCapture(e,t)&&(h=!1)):h=!1}if(r){const e=`${et(this.file,u-this.rank)}-${u}`;this.isValidMovePosition(e,t)?(s.push(e),this.isMoveCapture(e,t)&&(r=!1)):r=!1}if(l){const e=`${et(this.file,-1*(u-this.rank))}-${u}`;this.isValidMovePosition(e,t)?(s.push(e),this.isMoveCapture(e,t)&&(l=!1)):l=!1}}const d=this.file.charCodeAt(0),f=97,p=104;if(c)for(let u=d-1;u>=f;u--){const e=`${String.fromCharCode(u)}-${this.rank}`;if(!this.isValidMovePosition(e,t))break;if(s.push(e),this.isMoveCapture(e,t))break}if(g)for(let u=d+1;u<=p;u++){const e=`${String.fromCharCode(u)}-${this.rank}`;if(!this.isValidMovePosition(e,t))break;if(s.push(e),this.isMoveCapture(e,t))break}return s}resetLegalMoves(){this.legalMoves=null,this.defending.length=0}parseCode(){return"Knight"===this.name?"dark"===this.color?this.name[1].toLowerCase():this.name[1].toUpperCase():"dark"===this.color?this.name[0].toLowerCase():this.name[0].toUpperCase()}}class dt extends gt{constructor(t,e){super(t,e,"Pawn","consecutive"),Object(ct["a"])(this,"inStartingPosition",void 0),Object(ct["a"])(this,"direction",void 0),this.direction="dark"===this.color?-1:1,this.inStartingPosition=7===this.rank&&"dark"===this.color||2===this.rank&&"light"===this.color}getLegalMoves(t,e){if(!this.legalMoves){const i=[],s=this.rank+this.direction,a=`${this.file}-${s}`;if((s<=8||s>=1)&&"x"===t[a]&&(i.push(a),this.inStartingPosition)){const e=`${this.file}-${this.rank+2*this.direction}`;"x"===t[e]&&i.push(e)}const n=et(this.file,-1),o=et(this.file,1),r=[`${n}-${s}`,`${o}-${s}`];for(const h of r){const s=h[0]+h[2];(s===e.enPassantTargetSquare||t[h]&&"x"!==t[h]&&this.isOppositeColor(t[h]))&&i.push(""+h)}this.legalMoves=i}return this.legalMoves}}class ft extends gt{constructor(t,e){super(t,e,"Knight","jump")}getLegalMoves(t,e){return this.legalMoves||(this.legalMoves=[],this.legalMoves.push(`${et(this.file,1)}-${this.rank+2}`),this.legalMoves.push(`${et(this.file,-1)}-${this.rank+2}`),this.legalMoves.push(`${et(this.file,2)}-${this.rank+1}`),this.legalMoves.push(`${et(this.file,-2)}-${this.rank+1}`),this.legalMoves.push(`${et(this.file,2)}-${this.rank-1}`),this.legalMoves.push(`${et(this.file,-2)}-${this.rank-1}`),this.legalMoves.push(`${et(this.file,1)}-${this.rank-2}`),this.legalMoves.push(`${et(this.file,-1)}-${this.rank-2}`),this.legalMoves=this.filterValidMoves(this.legalMoves,t)),this.legalMoves}}class pt extends gt{constructor(t,e,i){super(t,e,"King","consecutive"),Object(ct["a"])(this,"canCastleShort",void 0),Object(ct["a"])(this,"canCastleLong",void 0),Object(ct["a"])(this,"isInCheck",!1),Object(ct["a"])(this,"checkBy",null),this.canCastleShort=i.includes("K")&&"light"===t||i.includes("k")&&"dark"===t,this.canCastleLong=i.includes("Q")&&"light"===t||i.includes("q")&&"dark"===t}getLegalMoves(t,e){if(!this.legalMoves){this.legalMoves=[];let e=[];e.push(`${et(this.file,-1)}-${this.rank+1}`),e.push(`${this.file}-${this.rank+1}`),e.push(`${et(this.file,1)}-${this.rank+1}`),e.push(`${et(this.file,-1)}-${this.rank-1}`),e.push(`${this.file}-${this.rank-1}`),e.push(`${et(this.file,1)}-${this.rank-1}`),e.push(`${et(this.file,-1)}-${this.rank}`),e.push(`${et(this.file,1)}-${this.rank}`),e=this.filterValidMoves(e,t);for(const i of e)1===this.checkCastlingForAttackers([i],t)&&this.legalMoves.push(i);if(this.canCastleShort&&this.canPerformCastleShort(t)){const e=[`${et(this.file,1)}-${this.rank}`,`${et(this.file,2)}-${this.rank}`],i=this.checkCastlingForAttackers(e,t);if(2===i){const t="light"===this.color?"g-1":"g-8";this.legalMoves.push(t)}}if(this.canCastleLong&&this.canPerformCastleLong(t)){const e=[`${et(this.file,-1)}-${this.rank}`,`${et(this.file,-2)}-${this.rank}`],i=this.checkCastlingForAttackers(e,t);if(2===i){const t="light"===this.color?"c-1":"c-8";this.legalMoves.push(t)}}}return this.legalMoves}checkCastlingForAttackers(t,e){const i=this.checkBy,s=this.isInCheck,a=this.position,n=this.rank,o=this.file;let r=0;for(const h of t){const t=JSON.parse(JSON.stringify(e));t[this.position]="x",t[h]=this.code,this.position=h,this.rank=Number(h[2]),this.file=h[0];const a=this.getCheckStatus(t);a.check||(r+=1),this.checkBy=i,this.isInCheck=s}return this.position=a,this.rank=n,this.file=o,r}canPerformCastleShort(t){return"x"===t[`${et(this.file,1)}-${this.rank}`]&&"x"===t[`${et(this.file,2)}-${this.rank}`]}canPerformCastleLong(t){return"x"===t[`${et(this.file,-1)}-${this.rank}`]&&"x"===t[`${et(this.file,-2)}-${this.rank}`]&&"x"===t[`${et(this.file,-3)}-${this.rank}`]}findAttackersFromPositions(t,e,i){t=t.filter(t=>at.includes(t));const s=t.filter(t=>e[t]===i);return s.length>0&&(this.isInCheck=!0,this.checkBy=s[0],!0)}checkDirection(t,e,i,s){if(at.includes(e)){if("x"===t[e])return!0;if(t[e]===i||t[e]===s)return this.isInCheck=!0,this.checkBy=e,!1}return!1}getCheckStatus(t){let e,i,s,a,n,o;this.isInCheck=!1,this.checkBy=null,"light"===this.color?(e=1,i="n",s="p",a="q",n="r",o="b"):(e=-1,i="N",s="P",a="Q",n="R",o="B");const r=[`${et(this.file,1)}-${this.rank+2}`,`${et(this.file,-1)}-${this.rank+2}`,`${et(this.file,2)}-${this.rank+1}`,`${et(this.file,-2)}-${this.rank+1}`,`${et(this.file,2)}-${this.rank-1}`,`${et(this.file,-2)}-${this.rank-1}`,`${et(this.file,1)}-${this.rank-2}`,`${et(this.file,-1)}-${this.rank-2}`];if(!this.findAttackersFromPositions(r,t,i)){const i=[`${et(this.file,1)}-${this.rank+e}`,`${et(this.file,-1)}-${this.rank+e}`];if(!this.findAttackersFromPositions(i,t,s)){let e=!0,i=!0,s=!0,r=!0,h=!0,l=!0,c=!0,g=!0;for(let d=1;d<=8;d++){if(e){const i=`${this.file}-${this.rank+d}`;e=this.checkDirection(t,i,a,n)}if(i){const e=`${this.file}-${this.rank-d}`;i=this.checkDirection(t,e,a,n)}if(s){const e=`${et(this.file,-d)}-${this.rank}`;s=this.checkDirection(t,e,a,n)}if(r){const e=`${et(this.file,d)}-${this.rank}`;r=this.checkDirection(t,e,a,n)}if(h){const e=`${et(this.file,-d)}-${this.rank+d}`;h=this.checkDirection(t,e,a,o)}if(l){const e=`${et(this.file,d)}-${this.rank+d}`;l=this.checkDirection(t,e,a,o)}if(c){const e=`${et(this.file,-d)}-${this.rank-d}`;c=this.checkDirection(t,e,a,o)}if(g){const e=`${et(this.file,d)}-${this.rank-d}`;g=this.checkDirection(t,e,a,o)}if(!e&&!i&&!s&&!r&&!h&&!l&&!c&&!g||this.isInCheck)break}}}return{check:this.isInCheck,piece:this.checkBy}}}class ut extends gt{constructor(t,e){super(t,e,"Queen","consecutive")}getLegalMoves(t,e){return this.legalMoves||(this.legalMoves=this.consecutiveMoveSearch(t,!0,!0)),this.legalMoves}}class bt extends gt{constructor(t,e){super(t,e,"Bishop","consecutive")}getLegalMoves(t,e){return this.legalMoves||(this.legalMoves=this.consecutiveMoveSearch(t,!1,!0)),this.legalMoves}}class vt extends gt{constructor(t,e,i){super(t,e,"Rook","consecutive"),Object(ct["a"])(this,"canCastle",void 0),Object(ct["a"])(this,"castleSide",void 0),i.includes("q")&&"a-8"===e&&"dark"===this.color?(this.canCastle=!0,this.castleSide="q"):i.includes("k")&&"h-8"===e&&"dark"===this.color?(this.canCastle=!0,this.castleSide="k"):i.includes("Q")&&"a-1"===e&&"light"===this.color?(this.canCastle=!0,this.castleSide="Q"):i.includes("K")&&"h-1"===e&&"light"===this.color?(this.canCastle=!0,this.castleSide="K"):(this.canCastle=!1,this.castleSide="-")}getLegalMoves(t,e){return this.legalMoves||(this.legalMoves=this.consecutiveMoveSearch(t,!0,!1)),this.legalMoves}}class kt{constructor(t="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1"){Object(ct["a"])(this,"fen",void 0),Object(ct["a"])(this,"boardMap",void 0),Object(ct["a"])(this,"piecesByLocation",void 0),Object(ct["a"])(this,"kings",void 0),Object(ct["a"])(this,"piecesByColor",{light:[],dark:[]}),Object(ct["a"])(this,"checkStatus","none"),Object(ct["a"])(this,"checkMateStatus",!1),Object(ct["a"])(this,"tie",!1),this.fen=_(t),this.boardMap=X(this.fen.piecePlacement);const{piecesByLocation:e,kings:i}=this.parsePieces();this.piecesByLocation=e,this.kings=i,this.resetLegalMovesAndCheckStatus(),this.updateCheckMate()}parsePieces(){const t={};let e=new pt("light","",""),i=new pt("light","","");for(const s of Object.keys(this.boardMap)){const a=this.boardMap[s];if("x"!==a){let n;const o=a.charCodeAt(0)>96?"dark":"light";"p"===a||"P"===a?n=new dt(o,s):"r"===a||"R"===a?n=new vt(o,s,this.fen.castlingAvailability):"n"===a||"N"===a?n=new ft(o,s):"b"===a||"B"===a?n=new bt(o,s):"q"===a||"Q"===a?n=new ut(o,s):(n=new pt(o,s,this.fen.castlingAvailability),"k"===a?i=n:e=n),t[s]=n,this.piecesByColor[o].push(n)}}return{piecesByLocation:t,kings:{k:i,K:e}}}getLegalMoves(t){const e=this.piecesByLocation[t];return e?[...e.getLegalMoves(this.boardMap,this.fen)]:[]}move(t,e,i=!1){let s=this.piecesByLocation[t];if(s){const a=s.getLegalMoves(this.boardMap,this.fen);if(a.includes(e)||i){let i=!1;if(this.piecesByLocation[e]||`${e[0]}${e[2]}`===this.fen.enPassantTargetSquare&&"Pawn"===s.name){let t=e;`${e[0]}${e[2]}`===this.fen.enPassantTargetSquare&&"Pawn"===s.name&&(t=e[0]+"-","3"===e[2]?t+="4":t+="5");const a=this.piecesByLocation[t].color;for(let e=0;e<this.piecesByColor[a].length;e++)if(this.piecesByColor[a][e]===this.piecesByLocation[t]){this.piecesByColor[a].splice(e,1);break}i=!0,delete this.piecesByLocation[t],this.boardMap[t]="x"}s.move(e),"Pawn"!==s.name||1!==s.rank&&8!==s.rank||(s=new ut(s.color,s.position)),this.piecesByLocation[e]=s,this.boardMap[e]=s.code,delete this.piecesByLocation[t],this.boardMap[t]="x",this.updateFEN(s,i),this.resetLegalMovesAndCheckStatus(),this.updateCheckMate()}}return this.fenString}updateFEN(t,e){this.fen.piecePlacement=tt(this.boardMap),"dark"===t.color&&(this.fen.fullMoveNumber+=1),"Pawn"===t.name||e?this.fen.halfMoveClock=0:this.fen.halfMoveClock+=1,this.updateEnPassant(t),this.updateCastling(t),this.fen.activeColor="light"===t.color?"b":"w"}updateCastling(t){if("-"!==this.fen.castlingAvailability&&t instanceof pt){const e=this.fen.halfMoveClock,i=this.fen.fullMoveNumber;"light"===t.color?"g-1"===t.position&&this.fen.castlingAvailability.includes("K")?(this.fen.castlingAvailability=this.fen.castlingAvailability.replace("K",""),this.fen.castlingAvailability=this.fen.castlingAvailability.replace("Q",""),this.move("h-1","f-1",!0)):"c-1"===t.position&&this.fen.castlingAvailability.includes("Q")&&(this.fen.castlingAvailability=this.fen.castlingAvailability.replace("Q",""),this.fen.castlingAvailability=this.fen.castlingAvailability.replace("K",""),this.move("a-1","d-1",!0)):"g-8"===t.position&&this.fen.castlingAvailability.includes("k")?(this.fen.castlingAvailability=this.fen.castlingAvailability.replace("k",""),this.fen.castlingAvailability=this.fen.castlingAvailability.replace("q",""),this.move("h-8","f-8",!0)):"c-8"===t.position&&this.fen.castlingAvailability.includes("q")&&(this.fen.castlingAvailability=this.fen.castlingAvailability.replace("q",""),this.fen.castlingAvailability=this.fen.castlingAvailability.replace("k",""),this.move("a-8","d-8",!0)),this.fen.halfMoveClock=e,this.fen.fullMoveNumber=i,t.canCastleShort=!1,t.canCastleLong=!1}else t instanceof vt&&"-"!==this.fen.castlingAvailability&&("light"===t.color?this.fen.castlingAvailability.includes("K")&&"h-1"===t.lastPosition?this.fen.castlingAvailability=this.fen.castlingAvailability.replace("K",""):this.fen.castlingAvailability.includes("Q")&&"a-1"===t.lastPosition&&(this.fen.castlingAvailability=this.fen.castlingAvailability.replace("Q","")):this.fen.castlingAvailability.includes("k")&&"h-8"===t.lastPosition?this.fen.castlingAvailability=this.fen.castlingAvailability.replace("k",""):this.fen.castlingAvailability.includes("q")&&"a-8"===t.lastPosition&&(this.fen.castlingAvailability=this.fen.castlingAvailability.replace("q","")),t.canCastle=!1,t.castleSide="-");0===this.fen.castlingAvailability.length&&(this.fen.castlingAvailability="-")}updateEnPassant(t){this.fen.enPassantTargetSquare="-",t instanceof dt&&t.inStartingPosition&&(t.inStartingPosition=!1,t.lastPosition&&2===Math.abs(Number(t.lastPosition[2])-Number(t.position[2]))&&(Number(t.lastPosition[2])>t.rank?this.fen.enPassantTargetSquare=`${t.file}${t.rank+1}`:this.fen.enPassantTargetSquare=`${t.file}${t.rank-1}`))}filterKingMovesDanger(t,e){const i=t.getLegalMoves(this.boardMap,this.fen),s=[];for(const a of e)if(a.legalMoves){if(a instanceof dt)for(const t of a.legalMoves)t[0]!==a.file&&s.push(t);else s.push(...a.legalMoves);for(const t of a.defending)s.push(t.position)}t.legalMoves=i.filter(t=>!s.includes(t))}filterMovesCheck(t,e,i,s){const a=e.checkBy?this.piecesByLocation[e.checkBy]:null;let n=[];if(a&&s.length>0){const o=a.moveType;if("King"===t.name){const t=[];for(const e of i)if(e.legalMoves){t.push(...e.legalMoves);for(const i of e.defending)t.push(i.position)}(a instanceof ut||a instanceof vt)&&(a.rank===e.rank?a.file.charCodeAt(0)<e.file.charCodeAt(0)?t.push(`${et(e.file,1)}-${e.rank}`):t.push(`${et(e.file,-1)}-${e.rank}`):a.file===e.file&&(a.rank>e.rank?t.push(`${e.file}-${e.rank-1}`):t.push(`${e.file}-${e.rank+1}`))),(a instanceof ut||a instanceof bt)&&(e.file.charCodeAt(0)<a.file.charCodeAt(0)&&e.rank>a.rank?t.push(`${et(e.file,-1)}-${e.rank+1}`):e.file.charCodeAt(0)>a.file.charCodeAt(0)&&e.rank>a.rank?t.push(`${et(e.file,1)}-${e.rank+1}`):e.file.charCodeAt(0)<a.file.charCodeAt(0)&&e.rank<a.rank?t.push(`${et(e.file,-1)}-${e.rank-1}`):e.file.charCodeAt(0)>a.file.charCodeAt(0)&&e.rank<a.rank&&t.push(`${et(e.file,1)}-${e.rank-1}`)),n=s.filter(e=>!t.includes(e))}else{const t=a.legalMoves,i=a.position;if(t&&i){const t=[i];if("consecutive"===o)if(a.file===e.file)if(e.rank>a.rank)for(let i=e.rank-1;i>a.rank;i--){const s=`${e.file}-${i}`;t.push(s)}else for(let i=a.rank-1;i>e.rank;i--){const s=`${e.file}-${i}`;t.push(s)}else if(a.rank===e.rank){const i=e.file.charCodeAt(0),s=a.file.charCodeAt(0);if(i<s)for(let a=i+1;a<s;a++){const i=`${String.fromCharCode(a)}-${e.rank}`;t.push(i)}else for(let a=s+1;a<i;a++){const i=`${String.fromCharCode(a)}-${e.rank}`;t.push(i)}}else{const i=e.file.charCodeAt(0),s=a.file.charCodeAt(0);let n,o,r=i<s?i+1:s+1;e.rank>a.rank?(n=a.rank+1,o=e.rank):(n=e.rank+1,o=a.rank);for(let e=n;e<o;e++){const i=`${String.fromCharCode(r)}-${e}`;t.push(i),r+=1}}n=s.filter(e=>t.includes(e))}}}return t.legalMoves=n,n}filterMovesThatExposeKing(t,e){const i=t.getLegalMoves(this.boardMap,this.fen),s=e.isInCheck,a=e.checkBy,n=[];for(const o of i){const i=JSON.parse(JSON.stringify(this.boardMap));i[o]=t.code,i[t.position]="x",e.getCheckStatus(i),e.isInCheck||n.push(o)}return e.isInCheck=s,e.checkBy=a,n}processMovesForColor(t,e){let i,s,a;"light"===t?(i=this.piecesByColor.light,s=this.kings.K,a=this.piecesByColor.dark):(i=this.piecesByColor.dark,s=this.kings.k,a=this.piecesByColor.light);for(const n of i){const t=n.getLegalMoves(this.boardMap,this.fen);e&&this.filterMovesCheck(n,s,a,t),n instanceof pt?this.filterKingMovesDanger(n,a):n.legalMoves=this.filterMovesThatExposeKing(n,s)}}resetLegalMovesAndCheckStatus(){let t,e;"w"===this.fen.activeColor?(t="dark",e="light"):(t="light",e="dark");for(const i of Object.keys(this.piecesByLocation))this.piecesByLocation[i].resetLegalMoves();this.processMovesForColor(t,!1),this.updateCheckStatus(),this.processMovesForColor(e,"none"!==this.checkStatus),this.checkTieStatus()}checkTieStatus(){if("none"===this.checkStatus){const t="w"===this.fen.activeColor?"light":"dark";let e=!1;for(const i of this.piecesByColor[t])if(i.getLegalMoves(this.boardMap,this.fen).length>0){e=!0;break}e||(this.tie=!0)}}getPiecesForOppositeColor(t){const e="light"===t?"dark":"light";return this.piecesByColor[e]}updateCheckStatus(){let t="none";const e="w"===this.fen.activeColor?"light":"dark",i="light"===e?this.kings.K:this.kings.k,s=i.getCheckStatus(this.boardMap);s.check&&(t=e),this.checkStatus=t}updateCheckMate(){const t=[];if("none"!==this.checkStatus){const e=this.piecesByColor[this.checkStatus];for(const i of e){const e=i.getLegalMoves(this.boardMap,this.fen);t.push(...e)}this.checkMateStatus=0===t.length}}print(){console.log(`\n8|${this.boardMap["a-8"]}|${this.boardMap["b-8"]}|${this.boardMap["c-8"]}|${this.boardMap["d-8"]}|${this.boardMap["e-8"]}|${this.boardMap["f-8"]}|${this.boardMap["g-8"]}|${this.boardMap["h-8"]}|\n7|${this.boardMap["a-7"]}|${this.boardMap["b-7"]}|${this.boardMap["c-7"]}|${this.boardMap["d-7"]}|${this.boardMap["e-7"]}|${this.boardMap["f-7"]}|${this.boardMap["g-7"]}|${this.boardMap["h-7"]}|\n6|${this.boardMap["a-6"]}|${this.boardMap["b-6"]}|${this.boardMap["c-6"]}|${this.boardMap["d-6"]}|${this.boardMap["e-6"]}|${this.boardMap["f-6"]}|${this.boardMap["g-6"]}|${this.boardMap["h-6"]}|\n5|${this.boardMap["a-5"]}|${this.boardMap["b-5"]}|${this.boardMap["c-5"]}|${this.boardMap["d-5"]}|${this.boardMap["e-5"]}|${this.boardMap["f-5"]}|${this.boardMap["g-5"]}|${this.boardMap["h-5"]}|\n4|${this.boardMap["a-4"]}|${this.boardMap["b-4"]}|${this.boardMap["c-4"]}|${this.boardMap["d-4"]}|${this.boardMap["e-4"]}|${this.boardMap["f-4"]}|${this.boardMap["g-4"]}|${this.boardMap["h-4"]}|\n3|${this.boardMap["a-3"]}|${this.boardMap["b-3"]}|${this.boardMap["c-3"]}|${this.boardMap["d-3"]}|${this.boardMap["e-3"]}|${this.boardMap["f-3"]}|${this.boardMap["g-3"]}|${this.boardMap["h-3"]}|\n2|${this.boardMap["a-2"]}|${this.boardMap["b-2"]}|${this.boardMap["c-2"]}|${this.boardMap["d-2"]}|${this.boardMap["e-2"]}|${this.boardMap["f-2"]}|${this.boardMap["g-2"]}|${this.boardMap["h-2"]}|\n1|${this.boardMap["a-1"]}|${this.boardMap["b-1"]}|${this.boardMap["c-1"]}|${this.boardMap["d-1"]}|${this.boardMap["e-1"]}|${this.boardMap["f-1"]}|${this.boardMap["g-1"]}|${this.boardMap["h-1"]}|\n  a b c d e g h h`)}get fenString(){return z(this.fen)}}class Mt{constructor(t){Object(ct["a"])(this,"color",void 0),this.color=t}move(t,e,i){return{from:"",to:""}}}var $t=Mt;class mt extends $t{constructor(t){super(t),Object(ct["a"])(this,"name",void 0),this.name="Random Mover"}move(t,e,i){const s=[];for(const a of i)for(const i of a.getLegalMoves(t,e))s.push({from:a.position,to:i});if(s.length>0){const t=Math.floor(Math.random()*s.length);return s[t]}return{from:"",to:""}}}class Ct extends $t{constructor(t){super(t),Object(ct["a"])(this,"name",void 0),Object(ct["a"])(this,"scores",{pieces:{Pawn:1,Knight:2,Bishop:3,Rook:3,Queen:4,King:5},capture:{multiplier:2},pressure:{multiplier:1.5},danger:{multiplier:-1},defending:{multiplier:1.5},defended:{multiplier:1.5}}),this.name="Matrix Evaluator"}move(t,e,i){const s=[];for(const a of i)if(a.color===this.color)for(const n of a.getLegalMoves(t,e)){const o=this.evaluateMove(a,n,t,e,i);s.push({from:a.position,to:n,score:o})}if(s.length>0){s.sort((t,e)=>t.score-e.score);const t=s[s.length-1].score,e=s.filter(e=>e.score===t),i=Math.floor(Math.random()*e.length);return{from:e[i].from,to:e[i].to}}return{from:"",to:""}}evaluateMove(t,e,i,s,a){let n=0;const o=i[e];if("x"!==o){const i=this.findPieceAtPosition(e,a);i&&(n+=this.scores.pieces[i.name]*this.scores.capture.multiplier);const s=this.findPiecesWithMovesToPosition(e,a);if(s){const t=s.filter(t=>t.color===this.color),e=s.filter(t=>t.color!==this.color);for(const i of e)n+=this.scores.pieces[i.name]*this.scores.danger.multiplier;for(const i of t)n+=this.scores.pieces[i.name]*this.scores.defending.multiplier}this.moveIsForward(t,e)&&(n+=1)}return n}findPieceAtPosition(t,e){return e.find(e=>e.position===t)}findPiecesWithMovesToPosition(t,e){return e.filter(e=>{var i;return null===(i=e.legalMoves)||void 0===i?void 0:i.includes(t)})}moveIsForward(t,e){return"light"===this.color?Number(e[2])>t.rank:Number(e[2])<t.rank}}var yt=Object(s["j"])({name:"Play",components:{CanvasBoard:lt},data(){return{containerHeight:300,containerWidth:300,isMounted:!1,legalMoves:[],startingFen:"",fenString:"",fen:{piecePlacement:"",activeColor:"",castlingAvailability:"",enPassantTargetSquare:"",halfMoveClock:0,fullMoveNumber:0},useAi:!1,ai:null,engine:new kt,selectedPiece:""}},mounted(){this.fenString=String(this.$route.query.fen),this.startingFen=this.fenString,this.useAi="true"===this.$route.query.ai,this.useAi&&(console.log("Creating AI player"),"RandomMover"===this.$route.query.aiType?this.ai=new mt("dark"):"MatrixEvaluator"===this.$route.query.aiType&&(this.ai=new Ct("dark"))),this.engine=new kt(this.fenString),console.log("created new engine"),this.onResize(),window.addEventListener("resize",this.onResize),this.isMounted=!0},methods:{onResize(){this.containerHeight=window.innerHeight,this.containerWidth=.6*window.innerWidth},calculateLegalMoves(t){this.selectedPiece=`${t.piece}, ${t.place}`,this.legalMoves=this.engine.getLegalMoves(t.place)},clearLegalMoves(){this.selectedPiece="",this.legalMoves.length=0},makeMove(t){if(this.fenString=this.engine.move(t.from,t.to),this.ai&&"b"===this.engine.fen.activeColor){const t=this.ai.move(this.engine.boardMap,this.engine.fen,this.engine.piecesByColor.dark);console.log(`AI move: from ${t.from} to ${t.to}`),this.fenString=this.engine.move(t.from,t.to)}},restart(){this.fenString=this.startingFen,this.engine=new kt(this.fenString)}}});i("00f2");const Ot=h()(yt,[["render",V]]);var jt=Ot;const Pt=[{path:"/",component:F},{path:"/play",component:jt}];var wt=Object(g["a"])({history:Object(g["b"])(),routes:Pt});i("ab8b"),i("0deb");const St=Object(s["c"])(c);St.use(wt),St.mount("#app")},e229:function(t,e,i){t.exports=i.p+"img/113.8e8aadb6.svg"},eb21:function(t,e,i){t.exports=i.p+"img/110.7ff2da55.svg"}});
//# sourceMappingURL=app.a1892285.js.map